Since I use Metasploit framework to emulate the attack, I didn't have any code to hand out.But I try my best to explain what I have done in the report  "Emulated process" in section "Tools for emulating the Scenario"